package no.nav.eux.camel;

import no.nav.eux.camel.processor.EnrichSedProcessor;

import org.apache.camel.CamelContext;
import org.apache.camel.EndpointInject;
import org.apache.camel.Produce;
import org.apache.camel.ProducerTemplate;
import org.apache.camel.builder.RouteBuilder;
import org.apache.camel.component.mock.MockEndpoint;
import org.apache.camel.test.junit4.CamelTestSupport;
import org.junit.Assert;
import org.junit.Before;
import org.junit.Ignore;
import org.junit.Test;

/**
The processor that enriches the SED is tested
 */
public class EnrichSedProcessorTest extends CamelTestSupport {

    @Override
    protected CamelContext createCamelContext() throws Exception {
        return super.createCamelContext();
    }

    @Produce(uri = "direct:start")
    protected ProducerTemplate producerTemplate;

    @EndpointInject(uri = "mock:result")
    protected MockEndpoint mockEndpoint;

    @Override
    protected RouteBuilder createRouteBuilder() {
        return new RouteBuilder() {
            public void configure() {
                from("direct:start")
                        .process(new EnrichSedProcessor())
                        .to("mock:result");
            }
        };
    }

    @Before
    public void setup() throws Exception {
        mockEndpoint.reset();
    }

    /**
     * The SED has changed
     */
    @Test
    @Ignore
    public void enrichSedTest() throws Exception {

        producerTemplate.sendBody(request);
        System.out.println("SED has changed: " + mockEndpoint.getExchanges().get(0).getIn().getBody());
        Assert.assertNotEquals(request, body());
    }

    private String request =
            "{\"documentEventType\":\"UPDATE_DOCUMENT\",\"payLoad\":{\"SED_DATA\":{\"A009\":{\"Addresses\":{\"Address\":[{\"Address\":{\"country\":\"BG\",\"town\":\"oslo\"},\"type\":\"countryResidence\"}]},\"articleRegulationECNo8832004\":\"121\",\"sedPackage\":\"Sector Components/Legislation Applicable/A009\",\"sedGVer\":\"4\",\"DecisionLegislationApplicable\":{\"PeriodForWhichDecisionApplies\":{\"FixedPeriod\":{\"endDate\":\"2018-01-07\",\"startDate\":\"2006-08-31\"}},\"memberStateWhichLegislationApplies\":\"BG\",\"Decision\":{\"InitialDecision\":\"yes\"},\"theDecisionAppliesForDurationActivityIndicator\":\"yes\"},\"sedVer\":\"0\",\"Person\":{\"AdditionalInformationPerson\":{\"nationality\":\"AT\"},\"PersonIdentification\":{\"forename\":\"Jo\",\"familyName\":\"Merkel\",\"sex\":\"male\",\"PINPersonInEachInstitution\":{\"PersonalIdentificationNumber\":[{\"country\":\"DK\",\"personalIdentificationNumber\":\"2222\"}]},\"dateBirth\":\"1960-09-11\"}}}},\"DOCUMENT_METADATA\":{\"creator\":{\"name\":\"clerka\",\"organisation\":{\"activeSince\":\"2010-01-01T08:00:00.000Z\",\"registryNumber\":\"\",\"acronym\":\"NAV02\",\"countryCode\":\"NO\",\"name\":\"NAV02\",\"location\":\"41.87194,12.56738\",\"id\":\"NAV02\"},\"id\":\"1\",\"type\":\"User\"},\"attachments\":null,\"starter\":true,\"displayName\":\"Notification of Posting\",\"mimeType\":\"json\",\"subProcessId\":28205,\"type\":\"A009\",\"creationDate\":\"2017-08-10T10:29:10Z\",\"conversations\":[{\"date\":\"2017-08-10T10:32:19Z\",\"versionId\":\"1\",\"userMessages\":[{\"receiver\":{\"activeSince\":\"2010-01-01T08:00:00.000Z\",\"registryNumber\":\"\",\"acronym\":\"DUMMY\",\"countryCode\":\"NO\",\"name\":\"DUMMY\",\"location\":\"41.87194,12.56738\",\"id\":\"DUMMY\"},\"sender\":{\"activeSince\":\"2010-01-01T08:00:00.000Z\",\"registryNumber\":\"\",\"acronym\":\"NAV02\",\"countryCode\":\"NO\",\"name\":\"NAV02\",\"location\":\"41.87194,12.56738\",\"id\":\"NAV02\"},\"action\":\"Start\",\"isSent\":true,\"id\":\"f25aa51bd1d247a99d5d53645bc496ac\"}],\"id\":\"438b5bde386f46e7b5b2bd250ab08bc2\",\"participants\":[{\"role\":\"Sender\",\"organisation\":{\"activeSince\":\"2010-01-01T08:00:00.000Z\",\"registryNumber\":\"\",\"acronym\":\"NAV02\",\"countryCode\":\"NO\",\"name\":\"NAV02\",\"location\":\"41.87194,12.56738\",\"id\":\"NAV02\"}},{\"role\":\"Receiver\",\"organisation\":{\"activeSince\":\"2010-01-01T08:00:00.000Z\",\"registryNumber\":\"\",\"acronym\":\"DUMMY\",\"countryCode\":\"NO\",\"name\":\"DUMMY\",\"location\":\"41.87194,12.56738\",\"id\":\"DUMMY\"}}]},{\"date\":\"2017-08-10T10:43:54Z\",\"versionId\":\"3\",\"userMessages\":[{\"receiver\":{\"activeSince\":\"2010-01-01T08:00:00.000Z\",\"registryNumber\":\"\",\"acronym\":\"DUMMY\",\"countryCode\":\"NO\",\"name\":\"DUMMY\",\"location\":\"41.87194,12.56738\",\"id\":\"DUMMY\"},\"sender\":{\"activeSince\":\"2010-01-01T08:00:00.000Z\",\"registryNumber\":\"\",\"acronym\":\"NAV02\",\"countryCode\":\"NO\",\"name\":\"NAV02\",\"location\":\"41.87194,12.56738\",\"id\":\"NAV02\"},\"action\":\"Update\",\"isSent\":true,\"id\":\"afd0c6dbba094118867436dc30c85c68\"}],\"id\":\"00882dd181114cb5a7fbb57474ebef76\",\"participants\":[{\"role\":\"Sender\",\"organisation\":{\"activeSince\":\"2010-01-01T08:00:00.000Z\",\"registryNumber\":\"\",\"acronym\":\"NAV02\",\"countryCode\":\"NO\",\"name\":\"NAV02\",\"location\":\"41.87194,12.56738\",\"id\":\"NAV02\"}},{\"role\":\"Receiver\",\"organisation\":{\"activeSince\":\"2010-01-01T08:00:00.000Z\",\"registryNumber\":\"\",\"acronym\":\"DUMMY\",\"countryCode\":\"NO\",\"name\":\"DUMMY\",\"location\":\"41.87194,12.56738\",\"id\":\"DUMMY\"}}]},{\"date\":\"2017-08-10T14:22:04Z\",\"versionId\":\"4\",\"userMessages\":[{\"receiver\":{\"activeSince\":\"2010-01-01T08:00:00.000Z\",\"registryNumber\":\"\",\"acronym\":\"DUMMY\",\"countryCode\":\"NO\",\"name\":\"DUMMY\",\"location\":\"41.87194,12.56738\",\"id\":\"DUMMY\"},\"sender\":{\"activeSince\":\"2010-01-01T08:00:00.000Z\",\"registryNumber\":\"\",\"acronym\":\"NAV02\",\"countryCode\":\"NO\",\"name\":\"NAV02\",\"location\":\"41.87194,12.56738\",\"id\":\"NAV02\"},\"action\":\"Update\",\"isSent\":true,\"id\":\"68ad83127573459782e04773b655c157\"}],\"id\":\"348194b708a34415a94ded70fbf1e587\",\"participants\":[{\"role\":\"Sender\",\"organisation\":{\"activeSince\":\"2010-01-01T08:00:00.000Z\",\"registryNumber\":\"\",\"acronym\":\"NAV02\",\"countryCode\":\"NO\",\"name\":\"NAV02\",\"location\":\"41.87194,12.56738\",\"id\":\"NAV02\"}},{\"role\":\"Receiver\",\"organisation\":{\"activeSince\":\"2010-01-01T08:00:00.000Z\",\"registryNumber\":\"\",\"acronym\":\"DUMMY\",\"countryCode\":\"NO\",\"name\":\"DUMMY\",\"location\":\"41.87194,12.56738\",\"id\":\"DUMMY\"}}]},{\"date\":\"2017-08-11T14:18:15Z\",\"versionId\":\"5\",\"userMessages\":[{\"receiver\":{\"activeSince\":\"2010-01-01T08:00:00.000Z\",\"registryNumber\":\"\",\"acronym\":\"DUMMY\",\"countryCode\":\"NO\",\"name\":\"DUMMY\",\"location\":\"41.87194,12.56738\",\"id\":\"DUMMY\"},\"sender\":{\"activeSince\":\"2010-01-01T08:00:00.000Z\",\"registryNumber\":\"\",\"acronym\":\"NAV02\",\"countryCode\":\"NO\",\"name\":\"NAV02\",\"location\":\"41.87194,12.56738\",\"id\":\"NAV02\"},\"action\":\"Update\",\"isSent\":true,\"id\":\"9bf8edc08c99426a879533313df82d79\"}],\"id\":\"0dfccbfe74964112887501f47d88c65c\",\"participants\":[{\"role\":\"Sender\",\"organisation\":{\"activeSince\":\"2010-01-01T08:00:00.000Z\",\"registryNumber\":\"\",\"acronym\":\"NAV02\",\"countryCode\":\"NO\",\"name\":\"NAV02\",\"location\":\"41.87194,12.56738\",\"id\":\"NAV02\"}},{\"role\":\"Receiver\",\"organisation\":{\"activeSince\":\"2010-01-01T08:00:00.000Z\",\"registryNumber\":\"\",\"acronym\":\"DUMMY\",\"countryCode\":\"NO\",\"name\":\"DUMMY\",\"location\":\"41.87194,12.56738\",\"id\":\"DUMMY\"}}]},{\"date\":\"2017-08-11T14:39:40Z\",\"versionId\":\"6\",\"userMessages\":[{\"receiver\":{\"activeSince\":\"2010-01-01T08:00:00.000Z\",\"registryNumber\":\"\",\"acronym\":\"DUMMY\",\"countryCode\":\"NO\",\"name\":\"DUMMY\",\"location\":\"41.87194,12.56738\",\"id\":\"DUMMY\"},\"sender\":{\"activeSince\":\"2010-01-01T08:00:00.000Z\",\"registryNumber\":\"\",\"acronym\":\"NAV02\",\"countryCode\":\"NO\",\"name\":\"NAV02\",\"location\":\"41.87194,12.56738\",\"id\":\"NAV02\"},\"action\":\"Update\",\"isSent\":true,\"id\":\"40c0e06afd0d4109953b51f321a2f307\"}],\"id\":\"65676d864a2347b2b95ddc3fe0ae47a7\",\"participants\":[{\"role\":\"Sender\",\"organisation\":{\"activeSince\":\"2010-01-01T08:00:00.000Z\",\"registryNumber\":\"\",\"acronym\":\"NAV02\",\"countryCode\":\"NO\",\"name\":\"NAV02\",\"location\":\"41.87194,12.56738\",\"id\":\"NAV02\"}},{\"role\":\"Receiver\",\"organisation\":{\"activeSince\":\"2010-01-01T08:00:00.000Z\",\"registryNumber\":\"\",\"acronym\":\"DUMMY\",\"countryCode\":\"NO\",\"name\":\"DUMMY\",\"location\":\"41.87194,12.56738\",\"id\":\"DUMMY\"}}]}],\"typeVersion\":\"4.0\",\"allowsAttachments\":true,\"versions\":[{\"date\":\"2017-08-10T10:29:10Z\",\"id\":\"1\",\"user\":{\"name\":\"clerka\",\"organisation\":{\"activeSince\":\"2010-01-01T08:00:00.000Z\",\"registryNumber\":\"\",\"acronym\":\"NAV02\",\"countryCode\":\"NO\",\"name\":\"NAV02\",\"location\":\"41.87194,12.56738\",\"id\":\"NAV02\"},\"id\":\"1\",\"type\":\"User\"}},{\"date\":\"2017-08-10T10:36:23Z\",\"id\":\"2\",\"user\":{\"name\":\"clerka\",\"organisation\":{\"activeSince\":\"2010-01-01T08:00:00.000Z\",\"registryNumber\":\"\",\"acronym\":\"NAV02\",\"countryCode\":\"NO\",\"name\":\"NAV02\",\"location\":\"41.87194,12.56738\",\"id\":\"NAV02\"},\"id\":\"1\",\"type\":\"User\"}},{\"date\":\"2017-08-10T10:39:36Z\",\"id\":\"3\",\"user\":{\"name\":\"clerka\",\"organisation\":{\"activeSince\":\"2010-01-01T08:00:00.000Z\",\"registryNumber\":\"\",\"acronym\":\"NAV02\",\"countryCode\":\"NO\",\"name\":\"NAV02\",\"location\":\"41.87194,12.56738\",\"id\":\"NAV02\"},\"id\":\"1\",\"type\":\"User\"}},{\"date\":\"2017-08-10T14:21:26Z\",\"id\":\"4\",\"user\":{\"name\":\"clerka\",\"organisation\":{\"activeSince\":\"2010-01-01T08:00:00.000Z\",\"registryNumber\":\"\",\"acronym\":\"NAV02\",\"countryCode\":\"NO\",\"name\":\"NAV02\",\"location\":\"41.87194,12.56738\",\"id\":\"NAV02\"},\"id\":\"1\",\"type\":\"User\"}},{\"date\":\"2017-08-11T14:04:54Z\",\"id\":\"5\",\"user\":{\"name\":\"clerka\",\"organisation\":{\"activeSince\":\"2010-01-01T08:00:00.000Z\",\"registryNumber\":\"\",\"acronym\":\"NAV02\",\"countryCode\":\"NO\",\"name\":\"NAV02\",\"location\":\"41.87194,12.56738\",\"id\":\"NAV02\"},\"id\":\"1\",\"type\":\"User\"}},{\"date\":\"2017-08-11T14:37:58Z\",\"id\":\"6\",\"user\":{\"name\":\"clerka\",\"organisation\":{\"activeSince\":\"2010-01-01T08:00:00.000Z\",\"registryNumber\":\"\",\"acronym\":\"NAV02\",\"countryCode\":\"NO\",\"name\":\"NAV02\",\"location\":\"41.87194,12.56738\",\"id\":\"NAV02\"},\"id\":\"1\",\"type\":\"User\"}},{\"date\":\"2017-08-17T12:02:07Z\",\"id\":\"7\",\"user\":{\"name\":\"clerka\",\"organisation\":{\"activeSince\":\"2010-01-01T08:00:00.000Z\",\"registryNumber\":\"\",\"acronym\":\"NAV02\",\"countryCode\":\"NO\",\"name\":\"NAV02\",\"location\":\"41.87194,12.56738\",\"id\":\"NAV02\"},\"id\":\"1\",\"type\":\"User\"}},{\"date\":\"2017-08-17T12:07:17Z\",\"id\":\"8\",\"user\":{\"name\":\"clerka\",\"organisation\":{\"activeSince\":\"2010-01-01T08:00:00.000Z\",\"registryNumber\":\"\",\"acronym\":\"NAV02\",\"countryCode\":\"NO\",\"name\":\"NAV02\",\"location\":\"41.87194,12.56738\",\"id\":\"NAV02\"},\"id\":\"1\",\"type\":\"User\"}},{\"date\":\"2017-08-17T12:15:44Z\",\"id\":\"9\",\"user\":{\"name\":\"clerka\",\"organisation\":{\"activeSince\":\"2010-01-01T08:00:00.000Z\",\"registryNumber\":\"\",\"acronym\":\"NAV02\",\"countryCode\":\"NO\",\"name\":\"NAV02\",\"location\":\"41.87194,12.56738\",\"id\":\"NAV02\"},\"id\":\"1\",\"type\":\"User\"}},{\"date\":\"2017-08-17T12:31:48Z\",\"id\":\"10\",\"user\":{\"name\":\"clerka\",\"organisation\":{\"activeSince\":\"2010-01-01T08:00:00.000Z\",\"registryNumber\":\"\",\"acronym\":\"NAV02\",\"countryCode\":\"NO\",\"name\":\"NAV02\",\"location\":\"41.87194,12.56738\",\"id\":\"NAV02\"},\"id\":\"1\",\"type\":\"User\"}},{\"date\":\"2017-08-17T12:40:05Z\",\"id\":\"11\",\"user\":{\"name\":\"clerka\",\"organisation\":{\"activeSince\":\"2010-01-01T08:00:00.000Z\",\"registryNumber\":\"\",\"acronym\":\"NAV02\",\"countryCode\":\"NO\",\"name\":\"NAV02\",\"location\":\"41.87194,12.56738\",\"id\":\"NAV02\"},\"id\":\"1\",\"type\":\"User\"}},{\"date\":\"2017-08-17T12:41:01Z\",\"id\":\"12\",\"user\":{\"name\":\"clerka\",\"organisation\":{\"activeSince\":\"2010-01-01T08:00:00.000Z\",\"registryNumber\":\"\",\"acronym\":\"NAV02\",\"countryCode\":\"NO\",\"name\":\"NAV02\",\"location\":\"41.87194,12.56738\",\"id\":\"NAV02\"},\"id\":\"1\",\"type\":\"User\"}},{\"date\":\"2017-08-17T12:53:21Z\",\"id\":\"13\",\"user\":{\"name\":\"clerka\",\"organisation\":{\"activeSince\":\"2010-01-01T08:00:00.000Z\",\"registryNumber\":\"\",\"acronym\":\"NAV02\",\"countryCode\":\"NO\",\"name\":\"NAV02\",\"location\":\"41.87194,12.56738\",\"id\":\"NAV02\"},\"id\":\"1\",\"type\":\"User\"}},{\"date\":\"2017-08-17T13:01:13Z\",\"id\":\"14\",\"user\":{\"name\":\"clerka\",\"organisation\":{\"activeSince\":\"2010-01-01T08:00:00.000Z\",\"registryNumber\":\"\",\"acronym\":\"NAV02\",\"countryCode\":\"NO\",\"name\":\"NAV02\",\"location\":\"41.87194,12.56738\",\"id\":\"NAV02\"},\"id\":\"1\",\"type\":\"User\"}},{\"date\":\"2017-08-17T13:05:43Z\",\"id\":\"15\",\"user\":{\"name\":\"clerka\",\"organisation\":{\"activeSince\":\"2010-01-01T08:00:00.000Z\",\"registryNumber\":\"\",\"acronym\":\"NAV02\",\"countryCode\":\"NO\",\"name\":\"NAV02\",\"location\":\"41.87194,12.56738\",\"id\":\"NAV02\"},\"id\":\"1\",\"type\":\"User\"}},{\"date\":\"2017-08-17T13:30:06Z\",\"id\":\"16\",\"user\":{\"name\":\"clerka\",\"organisation\":{\"activeSince\":\"2010-01-01T08:00:00.000Z\",\"registryNumber\":\"\",\"acronym\":\"NAV02\",\"countryCode\":\"NO\",\"name\":\"NAV02\",\"location\":\"41.87194,12.56738\",\"id\":\"NAV02\"},\"id\":\"1\",\"type\":\"User\"}},{\"date\":\"2017-08-17T13:36:49Z\",\"id\":\"17\",\"user\":{\"name\":\"clerka\",\"organisation\":{\"activeSince\":\"2010-01-01T08:00:00.000Z\",\"registryNumber\":\"\",\"acronym\":\"NAV02\",\"countryCode\":\"NO\",\"name\":\"NAV02\",\"location\":\"41.87194,12.56738\",\"id\":\"NAV02\"},\"id\":\"1\",\"type\":\"User\"}},{\"date\":\"2017-08-17T13:41:04Z\",\"id\":\"18\",\"user\":{\"name\":\"clerka\",\"organisation\":{\"activeSince\":\"2010-01-01T08:00:00.000Z\",\"registryNumber\":\"\",\"acronym\":\"NAV02\",\"countryCode\":\"NO\",\"name\":\"NAV02\",\"location\":\"41.87194,12.56738\",\"id\":\"NAV02\"},\"id\":\"1\",\"type\":\"User\"}},{\"date\":\"2017-08-17T13:46:59Z\",\"id\":\"19\",\"user\":{\"name\":\"clerka\",\"organisation\":{\"activeSince\":\"2010-01-01T08:00:00.000Z\",\"registryNumber\":\"\",\"acronym\":\"NAV02\",\"countryCode\":\"NO\",\"name\":\"NAV02\",\"location\":\"41.87194,12.56738\",\"id\":\"NAV02\"},\"id\":\"1\",\"type\":\"User\"}},{\"date\":\"2017-08-18T12:53:55Z\",\"id\":\"20\",\"user\":{\"name\":\"clerka\",\"organisation\":{\"activeSince\":\"2010-01-01T08:00:00.000Z\",\"registryNumber\":\"\",\"acronym\":\"NAV02\",\"countryCode\":\"NO\",\"name\":\"NAV02\",\"location\":\"41.87194,12.56738\",\"id\":\"NAV02\"},\"id\":\"1\",\"type\":\"User\"}},{\"date\":\"2017-08-18T13:01:09Z\",\"id\":\"21\",\"user\":{\"name\":\"clerka\",\"organisation\":{\"activeSince\":\"2010-01-01T08:00:00.000Z\",\"registryNumber\":\"\",\"acronym\":\"NAV02\",\"countryCode\":\"NO\",\"name\":\"NAV02\",\"location\":\"41.87194,12.56738\",\"id\":\"NAV02\"},\"id\":\"1\",\"type\":\"User\"}},{\"date\":\"2017-08-18T13:04:14Z\",\"id\":\"22\",\"user\":{\"name\":\"clerka\",\"organisation\":{\"activeSince\":\"2010-01-01T08:00:00.000Z\",\"registryNumber\":\"\",\"acronym\":\"NAV02\",\"countryCode\":\"NO\",\"name\":\"NAV02\",\"location\":\"41.87194,12.56738\",\"id\":\"NAV02\"},\"id\":\"1\",\"type\":\"User\"}}],\"caseId\":\"28203\",\"hasBusinessValidation\":false,\"lastUpdate\":\"2017-08-18T13:04:14Z\",\"ParentType\":\"A009\",\"id\":\"ca5cf4c119d443e493387e709e371a34\",\"validation\":{\"status\":\"valid\"},\"isFirstDocument\":true,\"direction\":\"OUT\",\"status\":\"active\"}},\"buc\":\"LA_BUC_04\",\"version\":\"1.0\"}";
}
